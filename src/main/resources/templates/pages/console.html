<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="@{/}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDNS 动态域名解析</title>
    <link rel="stylesheet" href="css/console.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="container">
    <!-- 左侧菜单 -->
    <div class="sidebar">
        <div class="user-info">
            <i class="fas fa-cloud fa-2x"></i>
            <h3>DDNS管理</h3>
        </div>
        <ul class="menu">
            <!-- 已保存的账号列表 -->
            <li th:each="user : ${users}" data-page="dns-manage" class="user-item">
                <a href="javascript:void(0)" class="user-link">
                    <i class="fas fa-server"></i>
                    <span th:text="${user.name}">腾讯云</span>
                </a>
                <button class="delete-account-btn" th:data-provider="${user.name}" th:data-id="${user.id}" title="删除账号">
                    <i class="fas fa-trash"></i>
                </button>
                <input type="hidden" class="user-id" th:value="${user.id}">
                <input type="hidden" class="user-key" th:value="${user.key}">
                <input type="hidden" class="user-provider" th:value="${user.name}">
            </li>
            <!-- 添加账号入口 -->
            <li data-page="add-account" class="active add-account-btn">
                <a href="javascript:void(0)" class="user-link">
                    <i class="fas fa-plus-circle"></i>
                    <span>添加账号</span>
                </a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <a th:href="@{/lock}" class="lock-link">
                <i class="fas fa-lock"></i> 锁定
            </a>
        </div>
    </div>

    <!-- 右侧内容区 -->
    <div class="main-content">
        <!-- 添加账号页面 -->
        <div class="page active" id="add-account">
            <div class="page-header">
                <h2><i class="fas fa-user-plus"></i> 添加云服务账号</h2>
            </div>
            
            <!-- 提示信息 -->
            <div id="alertBox" class="alert" 
                 th:class="${error != null} ? 'alert alert-danger' : (${status != null} ? 'alert alert-success' : 'alert')"
                 th:if="${error != null or status != null}">
                <span th:text="${error != null ? error : status}"></span>
            </div>

            <form id="addAccountForm" th:action="@{/addAccount}" method="post" class="account-form">
                <div class="form-group">
                    <label><i class="fas fa-cloud"></i> 云服务商</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="name" value="1" required>
                            <span class="radio-label">腾讯云</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="name" value="2">
                            <span class="radio-label">阿里云</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="secretId"><i class="fas fa-id-card"></i> SecretId</label>
                    <input type="text" id="secretId" name="id" required placeholder="请输入 SecretId">
                </div>

                <div class="form-group">
                    <label for="secretKey"><i class="fas fa-key"></i> SecretKey</label>
                    <input type="password" id="secretKey" name="key" required placeholder="请输入 SecretKey">
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> 保存账号
                </button>
            </form>
        </div>

        <!-- DNS管理页面 -->
        <div class="page" id="dns-manage">
            <div class="page-header">
                <h2><i class="fas fa-globe"></i> 域名解析管理</h2>
            </div>

            <!-- IPv4选择区域 -->
            <div class="ip-section">
                <div class="ip-header">
                    <h3><i class="fas fa-network-wired"></i> 公网IPv4获取</h3>
                    <div class="ip-actions">
                        <button id="refreshIp" class="btn btn-sm">
                            <i class="fas fa-sync-alt"></i> 刷新
                        </button>
                        <button id="addServiceBtn" class="btn btn-sm btn-secondary">
                            <i class="fas fa-plus"></i> 添加服务
                        </button>
                    </div>
                </div>
                <div id="ipv4List" class="ip-list">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> 正在获取IPv4...</div>
                </div>
                <div class="selected-ip">
                    <span>已选择IPv4: </span>
                    <strong id="selectedIpv4">未选择</strong>
                </div>
            </div>
            
            <!-- IPv6选择区域 -->
            <div class="ip-section ipv6-section">
                <div class="ip-header">
                    <h3><i class="fas fa-globe"></i> 公网IPv6获取</h3>
                    <div class="ip-actions">
                        <button id="refreshIpv6" class="btn btn-sm">
                            <i class="fas fa-sync-alt"></i> 刷新
                        </button>
                        <button id="addServiceBtnV6" class="btn btn-sm btn-secondary">
                            <i class="fas fa-plus"></i> 添加服务
                        </button>
                    </div>
                </div>
                <div id="ipv6List" class="ip-list">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> 正在获取IPv6...</div>
                </div>
                <div class="selected-ip">
                    <span>已选择IPv6: </span>
                    <strong id="selectedIpv6">未选择</strong>
                </div>
            </div>

            <!-- DDNS任务列表 -->
            <div class="ddns-section">
                <div class="section-header">
                    <h3><i class="fas fa-clock"></i> 正在运行的DDNS任务</h3>
                </div>
                <div id="ddnsTaskList" class="ddns-task-list">
                    <div class="empty"><i class="fas fa-inbox"></i> 暂无DDNS任务</div>
                </div>
            </div>

            <!-- 根域名列表与解析设置 -->
            <div class="domain-section">
                <h3><i class="fas fa-list"></i> 选择根域名</h3>
                <div id="domainList" class="domain-list">
                    <div class="loading">加载中...</div>
                </div>
                <input type="hidden" id="selectedDomain" value="">
                
                <!-- 子域名输入和操作 -->
                <div class="resolve-inline" id="resolveInline" style="display: none;">
                    <div class="resolve-input-wrapper">
                        <div class="resolve-input-group">
                            <input type="text" id="subdomain" placeholder="子域名 (如: www, @, test)">
                            <span class="domain-suffix" id="domainSuffix">.example.com</span>
                        </div>
                        <small class="form-hint">输入 @ 表示根域名，输入 www 表示 www.域名</small>
                    </div>
                    <div class="resolve-actions">
                        <button id="resolveBtn" class="btn btn-success btn-sm" disabled>
                            <i class="fas fa-check"></i> 解析到选中IP
                        </button>
                        <button id="addDdnsBtn" class="btn btn-primary btn-sm" disabled>
                            <i class="fas fa-clock"></i> 添加DDNS任务
                        </button>
                    </div>
                </div>
                
                <!-- 操作结果 -->
                <div id="resolveResult" class="resolve-result" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<!-- 添加DDNS任务模态框 -->
<div id="addDdnsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-clock"></i> 添加DDNS定时任务</h3>
            <button class="close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="ddns-config-info">
                <p><strong>域名:</strong> <span id="ddnsFullDomain">-</span></p>
            </div>
            <div class="form-group">
                <label><i class="fas fa-clock"></i> 定时间隔</label>
                <select id="ddnsInterval">
                    <option value="60">1 分钟</option>
                    <option value="120">2 分钟</option>
                    <option value="300" selected>5 分钟</option>
                    <option value="600">10 分钟</option>
                    <option value="1800">30 分钟</option>
                    <option value="3600">1 小时</option>
                </select>
            </div>
            <div class="form-group">
                <label><i class="fas fa-server"></i> IP获取服务</label>
                <select id="ddnsIpService">
                    <!-- 动态填充 -->
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button id="confirmAddDdns" class="btn btn-primary">
                <i class="fas fa-plus"></i> 添加任务
            </button>
        </div>
    </div>
</div>

<!-- 编辑DDNS任务模态框 -->
<div id="editDdnsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> 编辑DDNS任务</h3>
            <button class="close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="ddns-config-info">
                <p><strong>域名:</strong> <span id="editDdnsFullDomain">-</span></p>
            </div>
            <div class="form-group">
                <label><i class="fas fa-clock"></i> 定时间隔</label>
                <select id="editDdnsInterval">
                    <option value="60">1 分钟</option>
                    <option value="120">2 分钟</option>
                    <option value="300">5 分钟</option>
                    <option value="600">10 分钟</option>
                    <option value="1800">30 分钟</option>
                    <option value="3600">1 小时</option>
                </select>
            </div>
            <div class="form-group">
                <label><i class="fas fa-server"></i> IP获取服务</label>
                <select id="editDdnsIpService">
                    <!-- 动态填充 -->
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button id="confirmEditDdns" class="btn btn-primary">
                <i class="fas fa-save"></i> 保存
            </button>
        </div>
    </div>
</div>

<!-- 添加IP服务模态框 -->
<div id="addServiceModal" class="modal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h3><i class="fas fa-plus-circle"></i> 添加IP获取服务</h3>
            <button class="close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="addServiceIpType" value="ipv4">
            <div class="form-group">
                <label>服务类型</label>
                <div class="radio-group">
                    <label class="radio-item">
                        <input type="radio" name="serviceType" value="url" checked>
                        <span class="radio-label">在线URL</span>
                    </label>
                    <label class="radio-item">
                        <input type="radio" name="serviceType" value="local">
                        <span class="radio-label">本地网卡</span>
                    </label>
                </div>
            </div>
            <div class="form-group" id="urlInputGroup">
                <label>服务URL</label>
                <input type="text" id="newServiceUrl" placeholder="如: http://ip.sb">
                <small class="form-hint">输入一个返回纯IP文本的URL地址</small>
            </div>
            <div class="form-group" id="interfaceSelectGroup" style="display: none;">
                <label>选择网卡</label>
                <select id="networkInterfaceSelect">
                    <option value="">加载中...</option>
                </select>
                <small class="form-hint">选择要监控IP变化的本地网卡</small>
            </div>
        </div>
        <div class="modal-footer">
            <button id="confirmAddService" class="btn btn-primary">
                <i class="fas fa-check"></i> 添加
            </button>
        </div>
    </div>
</div>

<!-- 日志面板 -->
<div id="logPanel" class="log-panel">
    <div class="log-header">
        <span><i class="fas fa-terminal"></i> 操作日志</span>
        <div class="log-controls">
            <button id="clearLogBtn" class="log-btn" title="清空日志"><i class="fas fa-trash"></i></button>
            <button id="toggleLogBtn" class="log-btn" title="最小化"><i class="fas fa-minus"></i></button>
        </div>
    </div>
    <div class="log-body" id="logBody">
        <div class="log-entry log-info"><span class="log-time">--:--:--</span> 日志面板已就绪</div>
    </div>
</div>

<!-- 最小化的日志按钮 -->
<div id="logMinBtn" class="log-min-btn" style="display: none;">
    <i class="fas fa-terminal"></i>
    <span class="log-badge" id="logBadge">0</span>
</div>

<!-- 强制修改密码模态框 -->
<div id="changePasswordModal" class="modal" th:if="${needChangePassword}" th:style="${needChangePassword} ? 'display: flex;' : 'display: none;'">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-key"></i> 修改初始密码</h3>
        </div>
        <div class="modal-body">
            <div class="warning-box">
                <i class="fas fa-exclamation-triangle"></i>
                <p>检测到您正在使用初始密码，为了安全起见，请立即修改密码。</p>
                <p class="warning-note"><strong>注意：密码修改后将不再支持修改，请牢记新密码！</strong></p>
            </div>
            <form id="changePasswordForm" th:action="@{/modify/password}" method="post">
                <div class="form-group">
                    <label for="oldPassword">原密码</label>
                    <input type="password" id="oldPassword" name="password" placeholder="请输入原密码" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">新密码</label>
                    <input type="password" id="newPassword" name="modify" placeholder="请输入新密码" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="confirmPassword">确认新密码</label>
                    <input type="password" id="confirmPassword" placeholder="请再次输入新密码" required>
                </div>
                <div class="modal-footer">
                    <button type="submit" id="confirmChangePassword" class="btn btn-primary">
                        <i class="fas fa-check"></i> 确认修改
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 隐藏的凭证存储 -->
<input type="hidden" id="currentSecretId">
<input type="hidden" id="currentSecretKey">
<input type="hidden" id="currentProvider">
<input type="hidden" id="currentSelectedIp">
<input type="hidden" id="editingTaskId">
<input type="hidden" id="needChangePassword" th:value="${needChangePassword}">

<script src="js/console.js"></script>
</body>
</html>